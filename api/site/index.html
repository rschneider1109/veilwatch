<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Veilwatch</title>
  <style>
    :root { color-scheme: dark; }
    body {
      margin: 0;
      background: #0b0f14;
      color: #e9f1ff;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      padding: 32px;
    }
    h1 { margin: 0 0 12px; font-size: 34px; letter-spacing: 0.5px; }
    .sub { opacity: 0.8; margin-bottom: 20px; }
    .card {
      max-width: 860px;
      border: 1px solid #203043;
      border-radius: 14px;
      padding: 18px;
      background: rgba(255,255,255,0.03);
      box-shadow: 0 8px 30px rgba(0,0,0,0.35);
    }
    .row { display: flex; gap: 12px; flex-wrap: wrap; margin-top: 12px; }
    a.btn, button.btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      padding: 12px 14px;
      border-radius: 12px;
      border: 1px solid #2b3a4d;
      color: #e9f1ff;
      text-decoration: none;
      background: rgba(255,255,255,0.02);
      cursor: pointer;
      user-select: none;
    }
    a.btn:hover, button.btn:hover { border-color: #6aa9ff; }
    .mono { font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; font-size: 13px; }
    .status {
      margin-top: 14px;
      padding: 12px;
      border-radius: 12px;
      border: 1px solid #203043;
      background: rgba(0,0,0,0.25);
    }
    .ok { color: #7CFFB2; }
    .bad { color: #FF7C7C; }
    input {
      width: 100%;
      max-width: 520px;
      padding: 10px 12px;
      border-radius: 12px;
      border: 1px solid #2b3a4d;
      background: rgba(255,255,255,0.02);
      color: #e9f1ff;
      outline: none;
    }
    input:focus { border-color: #6aa9ff; }
    .hint { opacity: 0.75; margin-top: 8px; }
    .small { font-size: 13px; opacity: 0.85; }
  </style>
</head>

<body>
  <h1>Veilwatch</h1>
  <div class="sub">Launcher (served from <span class="mono">/app/site/index.html</span>)</div>

  <div class="card">
    <div class="small">
      If your full UI files are in this same folder, this page can launch them.
      If you only see this page, it means your UI files still aren’t in <span class="mono">api/site/</span> in GitHub yet.
    </div>

    <div class="row" style="margin-top:16px">
      <a class="btn" id="dmBtn" href="#" onclick="return openBest('dm')">Open DM Command Center</a>
      <a class="btn" id="plBtn" href="#" onclick="return openBest('player')">Open Player Command Center</a>
      <a class="btn" href="/api/state" target="_blank" rel="noreferrer">Open /api/state</a>
      <a class="btn" href="/api/health" target="_blank" rel="noreferrer">Open /api/health</a>
    </div>

    <div style="margin-top:16px">
      <div class="mono">Manual filename (if your pages have custom names):</div>
      <div class="row" style="align-items:center">
        <input id="manual" class="mono" placeholder="e.g. veilwatch_ops_dm_commandcenter_v5.html" />
        <button class="btn" onclick="openManual()">Open</button>
      </div>
      <div class="hint small">
        Put the file inside <span class="mono">api/site/</span> (same folder as this index.html).
      </div>
    </div>

    <div class="status mono" id="apiStatus">Checking API…</div>
  </div>

  <script>
    // Common filenames we can auto-detect.
    // Add your real filenames here once you know them.
    const CANDIDATES = {
      dm: [
        "veilwatch_ops_dm_commandcenter.html",
        "veilwatch_ops_dm_commandcenter_v5.html",
        "veilwatch_ops_dm.html",
        "dm.html",
        "DM.html"
      ],
      player: [
        "veilwatch_ops_player_commandcenter.html",
        "veilwatch_ops_player_commandcenter_v5.html",
        "veilwatch_ops_player.html",
        "player.html",
        "Player.html"
      ]
    };

    async function exists(file) {
      try {
        const r = await fetch("./" + file, { method: "HEAD", cache: "no-store" });
        return r.ok;
      } catch {
        return false;
      }
    }

    async function openBest(which) {
      for (const file of CANDIDATES[which]) {
        if (await exists(file)) {
          location.href = "./" + file;
          return false;
        }
      }
      alert(
        "Couldn't find a " + which.toUpperCase() + " page in this folder yet.\n\n" +
        "Put your full site files into api/site/ in GitHub, redeploy, then try again.\n\n" +
        "Or type the exact filename into the Manual box."
      );
      return false;
    }

    function openManual() {
      const v = document.getElementById("manual").value.trim();
      if (!v) return;
      location.href = "./" + v;
    }

    async function checkApi() {
      const el = document.getElementById("apiStatus");
      try {
        const h = await fetch("/api/health", { cache: "no-store" });
        const ht = await h.text();
        const s = await fetch("/api/state", { cache: "no-store" });
        const st = await s.text();

        const ok = h.ok && s.ok;
        el.innerHTML =
          (ok ? "<span class='ok'>API OK</span>" : "<span class='bad'>API ERROR</span>") +
          " | /api/health: " + h.status +
          " | /api/state: " + s.status +
          "<br><br><span style='opacity:.75'>health:</span> " + escapeHtml(ht).slice(0, 400) +
          "<br><br><span style='opacity:.75'>state:</span> " + escapeHtml(st).slice(0, 400);
      } catch (e) {
        el.innerHTML = "<span class='bad'>API ERROR</span> | " + escapeHtml(String(e));
      }
    }

    function escapeHtml(str) {
      return str.replace(/[&<>'"]/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;',"'":'&#39;','"':'&quot;'}[c]));
    }

    checkApi();
    // Optional: auto-try DM page on load (comment out if you hate auto-navigation)
    // openBest("dm");
  </script>
</body>
</html>
